<!doctype html>
<html>
    <head>
        <title>CICD</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <style type='text/css'>
        {% include "static/css/uikit.css"%}
    </style>
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"></script>
    <script type='text/javascript'>
        {% include "static/js/uikit.js"%}
        {% include "static/js/uikit-icons.js"%}
        {% include "static/js/app.js"%}
    </script>
    {% if message %}
    <h2 style='color: red;'>{{message}}</h2>
    {% endif %}

    <table>
        <tbody>
            {% for branch, sites in sites.items(): %}
            <tr>
                <td class="uk-heading-small">
                    {{branch}}
                    {{sites[0]['title']}}
                </td>
            </tr>
            <tr>
                <td>
                    <table class="uk-table uk-table-divider uk-table-striped uk-table-hover uk-table-small">
                        <thead>
                            <tr>
                                <th>Index</th>
                                <th>State</th>
                                <th>Action</th>
                                <th>Updated</th>
                                <th>Description</th>
                                <th>Last Author</th>
                                <th>Last Accessed</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for link in sites: %}
                            <tr>
                                <td>
                                    <a href="/cicd/start?name={{link['name']}}">
                                    {{link['key']}}-{{link['index']}}
                                    </a>
                                </td>
                                <td>
                                    {{link.get('docker_state')}}
                                    {% if link.get('docker_state') == 'running' %}
                                    <a class='docker-control' data-action='stop' data-name="{{link['name']}}" href="#">Stop</a>
                                    {% endif %}
                                    {% if link.get('docker_state') == 'stopped' %}
                                    <a class='docker-control' data-action='start' data-name="{{link['name']}}" href="#">Start</a>
                                    {% endif %}

                                    <span class="update-state" data-name="{{link['name']}}"></span>
                                </td>
                                <td>
                                    <a href="#" class='docker-control' data-action='destroy' data-name="{{link['name']}}" onclick="return confirm('Continue?');">Destroy</a>
                                </td>
                                <td>{{link.get('updated') and link.get('updated').strftime(DATE_FORMAT)}}</td>
                                <td>{{link.get('description')}}</td>
                                <td>{{link.get('author')}}</td>
                                <td>{{link.get('last_access') and link.get('last_access').strftime(DATE_FORMAT)}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>


</html>
